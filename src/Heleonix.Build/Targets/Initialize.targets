<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <Hx_Sys_NUnitConsoleExe>$(MSBuildThisFileDirectory)../../NUnit.ConsoleRunner.3.16.3/tools/nunit3-console.exe</Hx_Sys_NUnitConsoleExe>
    <Hx_Sys_ReportUnitExe>$(MSBuildThisFileDirectory)../../ReportUnit.1.2.1/tools/ReportUnit.exe</Hx_Sys_ReportUnitExe>
    <Hx_Sys_OpenCoverConsoleExe>$(MSBuildThisFileDirectory)../../OpenCover.4.7.1221/tools/OpenCover.Console.exe</Hx_Sys_OpenCoverConsoleExe>
    <Hx_Sys_ReportGeneratorExe Condition="'$(MSBuildRuntimeType)' == 'Core'">$(MSBuildThisFileDirectory)../../ReportGenerator.5.1.19/tools/net6.0/ReportGenerator.exe</Hx_Sys_ReportGeneratorExe>
    <Hx_Sys_ReportGeneratorExe Condition="'$(MSBuildRuntimeType)' != 'Core'">$(MSBuildThisFileDirectory)../../ReportGenerator.5.1.19/tools/net47/ReportGenerator.exe</Hx_Sys_ReportGeneratorExe>
    <Hx_Sys_NugetExe>$(MSBuildThisFileDirectory)../../NuGet.CommandLine.6.4.2/tools/NuGet.exe</Hx_Sys_NugetExe>
    <Hx_Sys_DocFXExe>$(MSBuildThisFileDirectory)../../docfx.console.2.59.4/tools/docfx.exe</Hx_Sys_DocFXExe>
    <Hx_Sys_GitExe>$(MSBuildThisFileDirectory)../../GitForWindows.2.39.2/tools/cmd/git.exe</Hx_Sys_GitExe>
  </PropertyGroup>

  <PropertyGroup>
    <Hx_WS_Dir>$(MSBuildStartupDirectory)</Hx_WS_Dir>
    <Hx_WS_BuildProjFile>$(Hx_WS_Dir)/*.hxbproj"</Hx_WS_BuildProjFile>
    <Hx_WS_RepositoryAPIUrl Condition="'$(Hx_WS_RepositoryAPIUrl)' == ''">https://api.github.com</Hx_WS_RepositoryAPIUrl>
    <Hx_WS_RepositoryUrl Condition="'$(Hx_WS_RepositoryUrl)' == ''">$(GO_MATERIAL_URL)</Hx_WS_RepositoryUrl><!--GoCD-->
    <Hx_WS_RepositoryUrl Condition="'$(Hx_WS_RepositoryUrl)' == ''">$(GIT_URL)</Hx_WS_RepositoryUrl><!--Jenkins-->
    <!--<Hx_WS_RepositoryUrl Condition="'$(Hx_WS_RepositoryUrl)' == ''">???</Hx_WS_RepositoryUrl>TeamCity-->
    <Hx_WS_RepositoryUrl Condition="'$(Hx_WS_RepositoryUrl)' == ''">$(CI_REPOSITORY_URL)</Hx_WS_RepositoryUrl><!--GitLab-->
    <Hx_WS_RepositoryUrl Condition="'$(Hx_WS_RepositoryUrl)' == ''">$(GITHUB_SERVER_URL)/$(GITHUB_REPOSITORY).git</Hx_WS_RepositoryUrl><!--GitHub-->
  </PropertyGroup>

  <Target Name="Hx_Initialize">
    <Message Text="> STARTING..."/>

    <Error Condition="'$(Hx_In_Targets)' == ''" Text="'$Hx_In_Targets' is not defined."/>
    <Error Condition="!Exists('$(Hx_WS_Dir)')" Text="'$Hx_WS_Dir' is not found."/>

    <Message Text="> 1/1: Initialization of global properties"/>

    <PropertyGroup>
      <Hx_In_Configuration Condition="'$(Hx_In_Configuration)' == ''">Release</Hx_In_Configuration>
      <Hx_In_Verbosity Condition="'$(Hx_In_Verbosity)' == ''">Normal</Hx_In_Verbosity>
    </PropertyGroup>

    <PropertyGroup>
      <Hx_Run_ArtifactsDir>$(Hx_WS_Dir)/Hx_Artifacts</Hx_Run_ArtifactsDir>
      <Hx_Run_Number Condition="'$(Hx_Run_Number)' == ''">$(GO_PIPELINE_COUNTER)</Hx_Run_Number><!--GoCD-->
      <Hx_Run_Number Condition="'$(Hx_Run_Number)' == ''">$(BUILD_NUMBER)</Hx_Run_Number><!--Jenkins, TeamCity-->
      <Hx_Run_Number Condition="'$(Hx_Run_Number)' == ''">$(GITHUB_RUN_NUMBER)</Hx_Run_Number><!--Github-->
      <Hx_Run_Number Condition="'$(Hx_Run_Number)' == ''">$(CI_PIPELINE_ID)</Hx_Run_Number><!--GitLab-->
      <Hx_Run_Number Condition="'$(Hx_Run_Number)' == ''">0</Hx_Run_Number>
    </PropertyGroup>

    <PropertyGroup>
      <Hx_NetBuild_ArtifactsDir>$(Hx_Run_ArtifactsDir)/Hx_NetBuild</Hx_NetBuild_ArtifactsDir>
      <Hx_NugetPublish_ArtifactsDir>$(Hx_Run_ArtifactsDir)/Hx_NugetPublish</Hx_NugetPublish_ArtifactsDir>
      <Hx_NUnit_ArtifactsDir>$(Hx_Run_ArtifactsDir)/Hx_NUnit</Hx_NUnit_ArtifactsDir>
      <Hx_OpenCover_ArtifactsDir>$(Hx_Run_ArtifactsDir)/Hx_OpenCover</Hx_OpenCover_ArtifactsDir>
      <Hx_ReportGenerator_ArtifactsDir>$(Hx_Run_ArtifactsDir)/Hx_ReportGenerator</Hx_ReportGenerator_ArtifactsDir>
      <Hx_ReportUnit_ArtifactsDir>$(Hx_Run_ArtifactsDir)/Hx_ReportUnit</Hx_ReportUnit_ArtifactsDir>
      <Hx_DocFX_ArtifactsDir>$(Hx_Run_ArtifactsDir)/Hx_DocFX</Hx_DocFX_ArtifactsDir>
      <Hx_ChangeLog_ArtifactsDir>$(Hx_Run_ArtifactsDir)/Hx_ChangeLog</Hx_ChangeLog_ArtifactsDir>
    </PropertyGroup>

    <Message Text="$Hx_Sys_NUnitConsoleExe: $(Hx_Sys_NUnitConsoleExe)"/>
    <Message Text="$Hx_Sys_ReportUnitExe: $(Hx_Sys_ReportUnitExe)"/>
    <Message Text="$Hx_Sys_OpenCoverConsoleExe: $(Hx_Sys_OpenCoverConsoleExe)"/>
    <Message Text="$Hx_Sys_ReportGeneratorExe: $(Hx_Sys_ReportGeneratorExe)"/>
    <Message Text="$Hx_Sys_NugetExe: $(Hx_Sys_NugetExe)"/>
    <Message Text="$Hx_Sys_DocFXExe: $(Hx_Sys_DocFXExe)"/>
    <Message Text="$Hx_Sys_GitExe: $(Hx_Sys_GitExe)"/>

    <Message Text="$Hx_WS_Dir: $(Hx_WS_Dir)"/>
    <Message Text="$Hx_WS_BuildProjFile: $(Hx_WS_BuildProjFile)"/>
    <Message Text="$Hx_WS_RepositoryAPIUrl: $(Hx_WS_RepositoryAPIUrl)"/>
    <Message Text="$Hx_WS_RepositoryUrl: $(Hx_WS_RepositoryUrl)"/>

    <Message Text="$Hx_In_Configuration: $(Hx_In_Configuration)"/>
    <Message Text="$Hx_In_Verbosity: $(Hx_In_Verbosity)"/>
    <Message Text="$Hx_In_Targets: $(Hx_In_Targets)"/>
    <Message Text="$Hx_In_BuildProjFile: $(Hx_In_BuildProjFile)"/>

    <Message Text="$Hx_Run_ArtifactsDir: $(Hx_Run_ArtifactsDir)"/>
    <Message Text="$Hx_Run_Number: $(Hx_Run_Number)"/>

    <Message Text="> DONE!"/>

    <OnError ExecuteTargets="Hx_OnError"/>
  </Target>
</Project>